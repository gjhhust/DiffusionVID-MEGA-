2024-03-12 20:51:03,330 mega_core INFO: Using 1 GPUs
2024-03-12 20:51:03,330 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_visdrone.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-12 20:51:03,331 mega_core INFO: Collecting env info (might take some time)
2024-03-12 20:51:07,316 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] Could not collect
        Pillow (8.3.2)
2024-03-12 20:51:07,317 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_visdrone.yaml
2024-03-12 20:51:07,317 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_visdrone_train_2",)
  TEST: ("VID_visdrone_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-12 20:51:07,320 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_visdrone_val',)
  TRAIN: ('VID_visdrone_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-12 20:51:07,321 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-12 20:51:27,871 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-12 20:51:35,901 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-12 20:51:36,695 mega_core.trainer INFO: Start training
2024-03-13 20:56:18,361 mega_core INFO: Using 1 GPUs
2024-03-13 20:56:18,361 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 20:56:18,361 mega_core INFO: Collecting env info (might take some time)
2024-03-13 20:56:19,891 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 20:56:19,891 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 20:56:19,892 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 20:56:19,894 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 20:56:19,895 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 20:56:24,805 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:02:59,836 mega_core INFO: Using 1 GPUs
2024-03-13 21:02:59,836 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:02:59,837 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:03:01,320 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:03:01,321 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:03:01,321 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:03:01,323 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:03:01,324 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:03:06,156 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:18:45,374 mega_core INFO: Using 1 GPUs
2024-03-13 21:18:45,375 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:18:45,375 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:18:46,857 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:18:46,857 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:18:46,858 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:18:46,860 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:18:46,861 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:18:51,756 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:18:52,683 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 21:18:52,875 mega_core.trainer INFO: Start training
2024-03-13 21:19:38,639 mega_core INFO: Using 1 GPUs
2024-03-13 21:19:38,639 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:19:38,640 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:19:40,106 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:19:40,107 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:19:40,107 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:19:40,110 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:19:40,110 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:19:44,937 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:19:45,677 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 21:19:45,760 mega_core.trainer INFO: Start training
2024-03-13 21:44:32,039 mega_core INFO: Using 1 GPUs
2024-03-13 21:44:32,039 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:44:32,039 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:44:33,563 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:44:33,563 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:44:33,563 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:44:33,565 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:44:33,565 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:44:38,574 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:47:02,051 mega_core INFO: Using 1 GPUs
2024-03-13 21:47:02,051 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:47:02,051 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:47:03,583 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:47:03,583 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:47:03,584 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:47:03,586 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:47:03,587 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:47:08,676 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:50:32,867 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 21:53:15,599 mega_core INFO: Using 1 GPUs
2024-03-13 21:53:15,600 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:53:15,600 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:53:17,274 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:53:17,275 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:53:17,275 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:53:17,279 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:53:17,280 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:53:22,432 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:53:23,246 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 21:55:53,804 mega_core INFO: Using 1 GPUs
2024-03-13 21:55:53,804 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:55:53,804 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:55:55,532 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:55:55,533 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:55:55,533 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:55:55,536 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:55:55,537 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:56:00,758 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:57:16,073 mega_core INFO: Using 1 GPUs
2024-03-13 21:57:16,074 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:57:16,074 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:57:17,617 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:57:17,618 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:57:17,618 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:57:17,621 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:57:17,621 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:57:22,462 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:59:05,315 mega_core INFO: Using 1 GPUs
2024-03-13 21:59:05,315 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:59:05,315 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:59:06,909 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:59:06,910 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:59:06,910 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:59:06,913 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:59:06,913 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:59:11,738 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 21:59:46,415 mega_core INFO: Using 1 GPUs
2024-03-13 21:59:46,416 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 21:59:46,416 mega_core INFO: Collecting env info (might take some time)
2024-03-13 21:59:48,000 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 21:59:48,000 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 21:59:48,001 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 21:59:48,003 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 21:59:48,004 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 21:59:52,821 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:28:39,513 mega_core INFO: Using 1 GPUs
2024-03-13 22:28:39,514 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 22:28:39,514 mega_core INFO: Collecting env info (might take some time)
2024-03-13 22:28:41,068 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 22:28:41,069 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 22:28:41,069 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 22:28:41,072 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 22:28:41,073 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 22:28:45,964 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:32:06,317 mega_core INFO: Using 1 GPUs
2024-03-13 22:32:06,317 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 22:32:06,318 mega_core INFO: Collecting env info (might take some time)
2024-03-13 22:32:07,876 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 22:32:07,877 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 22:32:07,877 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 22:32:07,880 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 22:32:07,880 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 22:32:12,804 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:33:29,231 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 22:34:03,210 mega_core INFO: Using 1 GPUs
2024-03-13 22:34:03,210 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 22:34:03,211 mega_core INFO: Collecting env info (might take some time)
2024-03-13 22:34:04,743 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 22:34:04,744 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 22:34:04,744 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 22:34:04,747 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 22:34:04,747 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 22:34:09,541 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:36:07,122 mega_core INFO: Using 1 GPUs
2024-03-13 22:36:07,122 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 22:36:07,123 mega_core INFO: Collecting env info (might take some time)
2024-03-13 22:36:08,654 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 22:36:08,654 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 22:36:08,655 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 22:36:08,656 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 22:36:08,657 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 22:36:13,397 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:36:19,012 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 22:36:22,429 mega_core.trainer INFO: Start training
2024-03-13 22:56:20,717 mega_core INFO: Using 1 GPUs
2024-03-13 22:56:20,717 mega_core INFO: Namespace(config_file='configs/vid_R_101_DiffusionVID_gaode_4.yaml', distributed=False, launcher='pytorch', local_rank=0, master_port='29999', motion_specific=False, opts=['OUTPUT_DIR', 'training_dir/test'], save_name='', skip_test=False)
2024-03-13 22:56:20,717 mega_core INFO: Collecting env info (might take some time)
2024-03-13 22:56:22,300 mega_core INFO: 
PyTorch version: 1.10.1+cu102
Is debug build: False
CUDA used to build PyTorch: 10.2
ROCM used to build PyTorch: N/A

OS: Ubuntu 20.04.6 LTS (x86_64)
GCC version: Could not collect
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.31

Python version: 3.8.18 (default, Sep 11 2023, 13:40:15)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-5.15.0-97-generic-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: 10.1.243
GPU models and configuration: 
GPU 0: NVIDIA TITAN Xp COLLECTORS EDITION
GPU 1: NVIDIA TITAN Xp
GPU 2: NVIDIA TITAN Xp COLLECTORS EDITION

Nvidia driver version: 535.161.07
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A

Versions of relevant libraries:
[pip3] mypy-extensions==1.0.0
[pip3] numpy==1.23.5
[pip3] torch==1.10.1+cu102
[pip3] torchaudio==0.10.1+cu102
[pip3] torchvision==0.11.2+cu102
[conda] numpy                     1.26.4                   pypi_0    pypi
        Pillow (8.3.2)
2024-03-13 22:56:22,301 mega_core INFO: Loaded configuration file configs/vid_R_101_DiffusionVID_gaode_4.yaml
2024-03-13 22:56:22,301 mega_core INFO: 
MODEL:
  META_ARCHITECTURE: "DiffusionDet"
  WEIGHT: "pth/DiffusionVID_R101.pth"
  BACKBONE:
    NAME: "build_resnet_fpn_backbone"
    CONV_BODY: "R-101-torchvision"
  RESNETS:
    OUT_FEATURES: ["res2", "res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    DEPTH: 101
    STRIDE_IN_1X1: False
    RES5_DILATION: 1
  FPN:
    IN_FEATURES: ["res3", "res4", "res5"]  # ["res2", "res3", "res4", "res5"]
    OUT_CHANNELS: 256
  ROI_HEADS:
    IN_FEATURES: ["p3", "p4", "p5"]  # ["p2", "p3", "p4", "p5"]
  ROI_BOX_HEAD:
    POOLER_TYPE: "ROIAlignV2"
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
  DiffusionDet:
    NUM_PROPOSALS: 300  # 500
    NUM_CLASSES: 11
    HIDDEN_DIM: 256
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    SAMPLE_STEP: 1
  VID:
    METHOD: "diffusion"
    ROI_BOX_HEAD:
      ATTENTION:
        ENABLE: False  # local attention
        STAGE: 1  # local attention stages
    MEGA:
      MIN_OFFSET: -0
      MAX_OFFSET: 7
      ALL_FRAME_INTERVAL: 8
      KEY_FRAME_LOCATION: 0
      SHUFFLED_CUR_TEST : False
      LOCAL:
        ENABLE: False  # local frame access on training phase
      GLOBAL:
        ENABLE: True  # global attention & memory
        RES_STAGE: 1
        SIZE: 24  # global ref frames in initialization
        STOP_UPDATE_AFTER_INIT_TEST: True
      REF_NUM_GLOBAL: 4  # global ref frames in training
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_METRIC: "distance"  # mamba, queue, distance
      MEMORY_MANAGEMENT_TYPE: "greedy"  # once, t
SOLVER:
  OPTIMIZER_TYPE: "adamw" #"adamw" "sgd"
  LR_SCHEDULER_TYPE: "step" # step or cosine
  BASE_LR: 0.0001 # 0.00001 # 0.001 for SGD
  BIAS_LR_FACTOR: 1.0
  BACKBONE_MULTIPLIER: 0.1
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  STEPS: (40000, 60000) # (240000, ) for aug # (80000, ) for COCO pretrained
  MAX_ITER: 65000 # 360000 for aug # 120000 for COCO pretrained
  WARMUP_ITERS: 13727 # 18000
  TEST_PERIOD: 5000
  CHECKPOINT_PERIOD: 5000
  ACCUMULATION_STEPS: 2  # batch size multiplier
  BATCH_REUSE_STEPS: 1
DATALOADER:
  SIZE_DIVISIBILITY: 32  # essential because of FPN
  NUM_WORKERS: 16  # 1 for debug
DATASETS:
  TRAIN: ("VID_gaode_4_train_2",)
  TEST: ("VID_gaode_4_val",) # ("VID_val_videos",) # ("YouTube_Objects",)
INPUT:
  PIXEL_MEAN: [ 123.675, 116.280, 103.530 ] # RGB
  PIXEL_STD: [ 58.395, 57.120, 57.375 ]
  TO_BGR255: False # pretrained torchvision weight use RGB format.
  TRANSFORM: True
  INFER_BATCH: 8 # must be same with MAX_OFFSET + 1
2024-03-13 22:56:22,304 mega_core INFO: Running with config:
AMP_VERBOSE: False
DATALOADER:
  ASPECT_RATIO_GROUPING: True
  NUM_WORKERS: 16
  PIN_MEMORY: False
  SIZE_DIVISIBILITY: 32
DATASETS:
  TEST: ('VID_gaode_4_val',)
  TRAIN: ('VID_gaode_4_train_2',)
DTYPE: float32
INPUT:
  BRIGHTNESS: 0.166
  CONTRAST: 0.5
  HORIZONTAL_FLIP_PROB_TRAIN: 0.5
  HUE: 0.5
  INFER_BATCH: 8
  MAX_SIZE_TEST: 1000
  MAX_SIZE_TRAIN: 1000
  MIN_SIZE_TEST: 600
  MIN_SIZE_TRAIN: (600,)
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RANROM_CROP_MAX_RATIO_TRAIN: 2.0
  RANROM_CROP_MAX_SIZE_TRAIN: 1.0
  RANROM_CROP_MIN_SIZE_TRAIN: 0.3
  RANROM_CROP_PROB_TRAIN: 0.5
  RANROM_PAD_PROB_TRAIN: 0.5
  RANROM_PAD_SIZE_TRAIN: 1.0
  SATURATION: 0.5
  TO_BGR255: False
  TRANSFORM: True
  VERTICAL_FLIP_PROB_TRAIN: 0.0
MODEL:
  BACKBONE:
    CONV_BODY: R-101-torchvision
    FREEZE_AT: 2
    FREEZE_CONV_BODY_AT: 2
    NAME: build_resnet_fpn_backbone
  CLS_AGNOSTIC_BBOX_REG: False
  DEVICE: cuda
  DiffusionDet:
    ACTIVATION: relu
    ALPHA: 0.25
    CLASS_WEIGHT: 2.0
    DEEP_SUPERVISION: True
    DIM_DYNAMIC: 64
    DIM_FEEDFORWARD: 2048
    DROPOUT: 0.0
    GAMMA: 2.0
    GIOU_WEIGHT: 2.0
    HIDDEN_DIM: 256
    L1_WEIGHT: 5.0
    NHEADS: 8
    NO_OBJECT_WEIGHT: 0.1
    NUM_CLASSES: 11
    NUM_CLS: 1
    NUM_DYNAMIC: 2
    NUM_HEADS: 3
    NUM_HEADS_LOCAL: 1
    NUM_PROPOSALS: 300
    NUM_REG: 3
    OTA_K: 5
    PRIOR_PROB: 0.01
    SAMPLE_STEP: 1
    SNR_SCALE: 2.0
    USE_FED_LOSS: False
    USE_FOCAL: True
    USE_NMS: True
  FBNET:
    ARCH: default
    ARCH_DEF: 
    BN_TYPE: bn
    DET_HEAD_BLOCKS: []
    DET_HEAD_LAST_SCALE: 1.0
    DET_HEAD_STRIDE: 0
    DW_CONV_SKIP_BN: True
    DW_CONV_SKIP_RELU: True
    KPTS_HEAD_BLOCKS: []
    KPTS_HEAD_LAST_SCALE: 0.0
    KPTS_HEAD_STRIDE: 0
    MASK_HEAD_BLOCKS: []
    MASK_HEAD_LAST_SCALE: 0.0
    MASK_HEAD_STRIDE: 0
    RPN_BN_TYPE: 
    RPN_HEAD_BLOCKS: 0
    SCALE_FACTOR: 1.0
    WIDTH_DIVISOR: 1
  FPN:
    FUSE_TYPE: sum
    IN_FEATURES: ['res3', 'res4', 'res5']
    NORM: 
    OUT_CHANNELS: 256
    USE_GN: False
    USE_RELU: False
  GROUP_NORM:
    DIM_PER_GP: -1
    EPSILON: 1e-05
    NUM_GROUPS: 32
  KEYPOINT_ON: False
  MASK_ON: False
  META_ARCHITECTURE: DiffusionDet
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.12, 57.375]
  RESNETS:
    BACKBONE_OUT_CHANNELS: 1024
    DEFORMABLE_GROUPS: 1
    DEFORM_MODULATED: False
    DEFORM_NUM_GROUPS: 1
    DEFORM_ON_PER_STAGE: (False, False, False, False)
    DEPTH: 101
    NORM: FrozenBN
    NUM_GROUPS: 1
    OUT_FEATURES: ['res2', 'res3', 'res4', 'res5']
    RES2_OUT_CHANNELS: 256
    RES5_DILATION: 1
    STAGE_WITH_DCN: (False, False, False, False)
    STEM_FUNC: StemWithFixedBatchNorm
    STEM_OUT_CHANNELS: 64
    STRIDE_IN_1X1: False
    TRANS_FUNC: BottleneckWithFixedBatchNorm
    WIDTH_PER_GROUP: 64
    WITH_MODULATED_DCN: False
  RETINANET:
    ANCHOR_SIZES: (32, 64, 128, 256, 512)
    ANCHOR_STRIDES: (8, 16, 32, 64, 128)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BBOX_REG_BETA: 0.11
    BBOX_REG_WEIGHT: 4.0
    BG_IOU_THRESHOLD: 0.4
    FG_IOU_THRESHOLD: 0.5
    INFERENCE_TH: 0.05
    LOSS_ALPHA: 0.25
    LOSS_GAMMA: 2.0
    NMS_TH: 0.4
    NUM_CLASSES: 81
    NUM_CONVS: 4
    OCTAVE: 2.0
    PRE_NMS_TOP_N: 1000
    PRIOR_PROB: 0.01
    SCALES_PER_OCTAVE: 3
    STRADDLE_THRESH: 0
    USE_C5: True
  RETINANET_ON: False
  ROI_BOX_HEAD:
    CONV_HEAD_DIM: 256
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 31
    NUM_STACKED_CONVS: 4
    POOLER_RESOLUTION: 7
    POOLER_SAMPLING_RATIO: 2
    POOLER_SCALES: (0.0625,)
    POOLER_TYPE: ROIAlignV2
    PREDICTOR: FastRCNNPredictor
    USE_GN: False
  ROI_HEADS:
    BATCH_SIZE_PER_IMAGE: 128
    BBOX_REG_WEIGHTS: (10.0, 10.0, 5.0, 5.0)
    BG_IOU_THRESHOLD: 0.5
    DETECTIONS_PER_IMG: 300
    FG_IOU_THRESHOLD: 0.5
    IN_FEATURES: ['p3', 'p4', 'p5']
    NMS: 0.5
    POSITIVE_FRACTION: 0.25
    SCORE_THRESH: 0.001
    USE_FPN: False
  ROI_KEYPOINT_HEAD:
    CONV_LAYERS: (512, 512, 512, 512, 512, 512, 512, 512)
    FEATURE_EXTRACTOR: KeypointRCNNFeatureExtractor
    MLP_HEAD_DIM: 1024
    NUM_CLASSES: 17
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    PREDICTOR: KeypointRCNNPredictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
  ROI_MASK_HEAD:
    CONV_LAYERS: (256, 256, 256, 256)
    DILATION: 1
    FEATURE_EXTRACTOR: ResNet50Conv5ROIFeatureExtractor
    MLP_HEAD_DIM: 1024
    POOLER_RESOLUTION: 14
    POOLER_SAMPLING_RATIO: 0
    POOLER_SCALES: (0.0625,)
    POSTPROCESS_MASKS: False
    POSTPROCESS_MASKS_THRESHOLD: 0.5
    PREDICTOR: MaskRCNNC4Predictor
    RESOLUTION: 14
    SHARE_BOX_FEATURE_EXTRACTOR: True
    USE_GN: False
  RPN:
    ANCHOR_SIZES: (64, 128, 256, 512)
    ANCHOR_STRIDE: (16,)
    ASPECT_RATIOS: (0.5, 1.0, 2.0)
    BATCH_SIZE_PER_IMAGE: 256
    BG_IOU_THRESHOLD: 0.3
    FG_IOU_THRESHOLD: 0.7
    FPN_POST_NMS_PER_BATCH: True
    FPN_POST_NMS_TOP_N_TEST: 2000
    FPN_POST_NMS_TOP_N_TRAIN: 2000
    MIN_SIZE: 0
    NMS_THRESH: 0.7
    POSITIVE_FRACTION: 0.5
    POST_NMS_TOP_N_TEST: 300
    POST_NMS_TOP_N_TRAIN: 300
    PRE_NMS_TOP_N_TEST: 6000
    PRE_NMS_TOP_N_TRAIN: 6000
    RPN_HEAD: SingleConvRPNHead
    STRADDLE_THRESH: 0
    USE_FPN: False
  RPN_ONLY: False
  SWIN:
    OUT_FEATURES: (0, 1, 2, 3)
    SIZE: B
    USE_CHECKPOINT: False
  VID:
    DFF:
      MAX_OFFSET: 0
      MIN_OFFSET: -9
    ENABLE: True
    FGFA:
      ALL_FRAME_INTERVAL: 19
      KEY_FRAME_LOCATION: 9
      MAX_OFFSET: 9
      MIN_OFFSET: -9
      REF_NUM: 2
    FLOWNET_WEIGHT: models/flownet.ckpt
    IGNORE: False
    MEGA:
      ALL_FRAME_INTERVAL: 8
      GLOBAL:
        BOX_ATTEND: True
        ENABLE: True
        PIXEL_ATTEND: False
        PIXEL_STAGE: 0
        RES_STAGE: 1
        SHUFFLE: True
        SIZE: 24
        STOP_UPDATE_AFTER_INIT_TEST: True
      KEY_FRAME_LOCATION: 0
      LOCAL:
        ENABLE: False
        PIXEL_ATTEND: False
      MAX_OFFSET: 7
      MEMORY:
        ENABLE: False
        SIZE: 25
      MEMORY_MANAGEMENT_METRIC: distance
      MEMORY_MANAGEMENT_SIZE_PIXEL_TEST: 1000
      MEMORY_MANAGEMENT_SIZE_PIXEL_TRAIN: 3000
      MEMORY_MANAGEMENT_SIZE_TEST: 900
      MEMORY_MANAGEMENT_SIZE_TRAIN: 300
      MEMORY_MANAGEMENT_TYPE: greedy
      MHA: False
      MIN_OFFSET: 0
      RATIO: 0.2
      REF_NUM_GLOBAL: 4
      REF_NUM_LOCAL: 2
      REF_NUM_MEM: 3
      SHUFFLED_CUR_TEST: False
    METHOD: diffusion
    RDN:
      ALL_FRAME_INTERVAL: 37
      KEY_FRAME_LOCATION: 18
      MAX_OFFSET: 18
      MIN_OFFSET: -18
      RATIO: 0.2
      REF_NUM: 2
    ROI_BOX_HEAD:
      ATTENTION:
        ADVANCED_STAGE: 0
        EMBED_DIM: 64
        ENABLE: False
        GROUP: 16
        STAGE: 1
      REDUCE_CHANNEL: False
    RPN:
      REF_POST_NMS_TOP_N: 75
      REF_PRE_NMS_TOP_N: 6000
  WEIGHT: pth/DiffusionVID_R101.pth
OUTPUT_DIR: training_dir/test
PATHS_CATALOG: /data1/jiahaoguo/DiffusionVID/mega_core/config/paths_catalog.py
SOLVER:
  ACCUMULATION_STEPS: 2
  BACKBONE_MULTIPLIER: 0.1
  BASE_LR: 0.0001
  BATCH_REUSE_STEPS: 1
  BIAS_LR_FACTOR: 1.0
  CHECKPOINT_PERIOD: 5000
  CLIP_GRADIENTS:
    CLIP_TYPE: full_model
    CLIP_VALUE: 1.0
    ENABLED: True
    NORM_TYPE: 2.0
  GAMMA: 0.1
  IMS_PER_BATCH: 1
  LR_SCHEDULER_TYPE: step
  MAX_ITER: 65000
  MOMENTUM: 0.9
  OPTIMIZER: ADAMW
  OPTIMIZER_TYPE: adamw
  STEPS: (40000, 60000)
  TEST_PERIOD: 5000
  WARMUP_FACTOR: 0.3333333333333333
  WARMUP_ITERS: 13727
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TENSORBOARD: True
TEST:
  BBOX_AUG:
    ENABLED: False
    H_FLIP: False
    MAX_SIZE: 4000
    SCALES: ()
    SCALE_H_FLIP: False
  DETECTIONS_PER_IMG: 300
  EXPECTED_RESULTS: []
  EXPECTED_RESULTS_SIGMA_TOL: 4
  IMS_PER_BATCH: 1
  SEQ_NMS: False
2024-03-13 22:56:22,304 mega_core INFO: Saving config into: training_dir/test/config.yml
2024-03-13 22:56:27,205 mega_core.utils.checkpoint INFO: Loading checkpoint from pth/DiffusionVID_R101.pth
2024-03-13 22:56:43,220 mega_core.utils.miscellaneous INFO: Saving labels mapping into training_dir/test/labels.json
2024-03-13 22:56:46,600 mega_core.trainer INFO: Start training
2024-03-13 22:57:22,457 mega_core.trainer INFO: eta: 1 day, 8:21:15  iter: 21  loss: 15.0733 (17.2830)  loss_ce: 0.9263 (1.2228)  loss_bbox: 0.2130 (0.4749)  loss_giou: 1.9173 (2.0085)  loss_ce_0: 1.2638 (1.5862)  loss_bbox_0: 0.3995 (0.7648)  loss_giou_0: 2.3257 (2.2839)  loss_ce_1: 2.0516 (2.2300)  loss_bbox_1: 0.3073 (0.5979)  loss_giou_1: 2.0737 (2.1005)  loss_ce_2: 1.2158 (1.4677)  loss_bbox_2: 0.2438 (0.5085)  loss_giou_2: 1.9396 (2.0373)  time: 0.6169 (0.8962)  data: 0.0006 (0.0532)  lr: 0.000003  max mem: 6046
